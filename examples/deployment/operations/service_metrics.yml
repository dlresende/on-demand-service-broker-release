- type: replace
  path: /releases/-
  value: {name: service-metrics, version: latest}

- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: service-metrics-adapter
    release: ((broker_release))

- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: service-metrics
    release: service-metrics
    properties:
      service_metrics:
        execution_interval_seconds: 30
        origin: ((broker_deployment_name))
        monit_dependencies: [broker]
        tls:
          ca: ((loggregator.tls.ca_cert))
          cert: ((loggregator.tls.metron.cert))
          key: ((loggregator.tls.metron.key))

- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: metron_agent
    release: loggregator
    properties:
      metron_agent:
        deployment: ((broker_deployment_name))
        etcd:
          client_cert: ((metron_agent.etcd.client_cert))
          client_key: ((metron_agent.etcd.client_key))
        protocols:
          - tls
        tls:
          metron:
            cert: ((metron_agent.tls.metron.cert))
            key: ((metron_agent.tls.metron.key))
      metron_endpoint:
        shared_secret: ((metron_endpoint.shared_secret))
      loggregator:
        etcd:
          ca_cert: ((loggregator.etcd.ca_cert))
          machines:
          - cf-etcd.service.cf.internal
          require_ssl: true
        tls:
          metron:
            cert: ((loggregator.tls.metron.cert))
            key: ((loggregator.tls.metron.key))
          ca_cert: ((loggregator.tls.ca_cert))
      loggregator_endpoint:
        shared_secret: ((metron_endpoint.shared_secret))

